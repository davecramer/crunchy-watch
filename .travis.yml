sudo: required

  
env:
- CHANGE_MINIKUBE_NONE_USER=true

before_script:
- mkdir $HOME/cdev $HOME/cdev/src $HOME/cdev/pkg $HOME/cdev/bin
- sudo apt-get update -qq
- curl https://storage.googleapis.com/golang/go1.8.7.linux-amd64.tar.gz | tar -xzf -
- curl -LO https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl 
- chmod +x kubectl && sudo mv kubectl /usr/local/bin/
- curl -Lo minikube https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
- chmod +x minikube && sudo mv minikube /usr/local/bin/
- sudo minikube start --vm-driver=none --kubernetes-version=v1.9.0
- minikube update-context
- JSONPATH='{range .items[*]}{@.metadata.name}:{range @.status.conditions[*]}{@.type}={@.status};{end}{end}'; 
    until kubectl get nodes -o jsonpath="$JSONPATH" 2>&1 | grep -q "Ready=True"; do sleep 1; done

script:
- export PATH=$PATH:$HOME/go/bin
- export GOPATH=$HOME/cdev
- export GOBIN=$GOPATH/bin
- export PATH=$PATH:$GOBIN
- export CCPROOT=$GOPATH/crunchydata/crunchy-containers
- cd $GOPATH
- mkdir crunchydata
- cd crunchydata
- git clone https://github.com/CrunchyData/crunchy-containers.git
- cd crunchy-containers
- git checkout 1.7.2
- go get github.com/blang/expenv
- cd examples/kube/primary-replica/
- kubectl create -f $CCPROOT/conf/demo-namespace.json
- kubectl config set-context $(kubectl config current-context) --namespace=demo
- ./run.sh
- docker ps 

- export GOPATH=$HOME/odev
- mkdir -p $GOPATH/src $GOPATH/bin $GOPATH/pkg
- mkdir -p $GOPATH/src/github.com/crunchydata/
- export PATH=$PATH:$GOPATH/bin
- export CCP_BASEOS=centos7
- export CCP_PGVERSION=10
- export CCP_PG_FULLVERSION=10.2
- cd $GOPATH/src/github.com/crunchydata
- ls $TRAVIS_BUILD_DIR
- mv $TRAVIS_BUILD_DIR/../crunchy-watch .
- cd crunchy-watch
- make setup
- make
- make docker-image
- cd examples/kube
- ./run.sh